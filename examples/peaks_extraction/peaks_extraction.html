
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Peaks extraction methods &#8212; Biotuner 0.0.1 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/example_gallery_styles.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Harmonicity metrics" href="../harmonicity_metrics/harmonicity_metrics.html" />
    <link rel="prev" title="Harmonicity Metrics Computation on MNE Epochs File" href="../biotuner_MNE/biotuner_MNE.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Biotuner 0.0.1 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Menu:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started.html">
   Getting started with Biotuner
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cite_us.html">
   Cite us
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../biotuner_MNE/biotuner_MNE.html">
     Harmonicity Metrics Computation on MNE Epochs File
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Peaks extraction methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../harmonicity_metrics/harmonicity_metrics.html">
     Harmonicity metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../harmonic_spectrum/harmonic_spectrum.html">
     From Spectral Peaks to Harmonic Spectrum Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scale_construction/scale_construction.html">
     Constructing musical tunings with biosignals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spectral_chords/spectral_chords.html">
     Deriving spectral chords from biosignals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rhythm_construction/rhythm_construction.html">
     Constructing euclidian rhythms from biotunings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../phase_amplitude_coupling/phase_amplitude_coupling.html">
     Phase-Amplitude Coupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../api/index.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/biotuner_object.html">
     Biotuner object
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/metrics.html">
     Harmonicity Metrics
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/harmonic_spectrum.html">
     Harmonic spectrum
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/harmonic_connectivity.html">
     Harmonic connectivity
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/peaks_extension.html">
     Peaks Extension
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/peaks_extraction.html">
     Peaks Extraction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/rhythm_construction.html">
     Rhythm construction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/scale_construction.html">
     Scale construction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/utils.html">
     Biotuner utilities
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/examples/peaks_extraction/peaks_extraction.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retrieving-frequency-information-from-simulated-signals-using-the-biotuner">
   Retrieving frequency information from simulated signals using the biotuner
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#peaks-functions-see-the-doc">
   Peaks functions (see the doc)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fixed">
   Fixed
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fooof">
   FOOOF
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#empirical-mode-decomposition">
   Empirical Mode Decomposition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#harmonic-recurrence">
   Harmonic recurrence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#endogeneous-inter-modulation-components">
   Endogeneous Inter-Modulation Components
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#effect-of-noise-on-peaks-detection">
   Effect of noise on peaks detection
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#we-will-now-quantify-the-effect-of-noise-on-peak-detection-by-plotting-the-performance-of-the-algorithms-for-different-intensity-of-noise">
     We will now quantify the effect of noise on peak detection by plotting the performance of the algorithms for different intensity of noise.
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Peaks extraction methods</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retrieving-frequency-information-from-simulated-signals-using-the-biotuner">
   Retrieving frequency information from simulated signals using the biotuner
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#peaks-functions-see-the-doc">
   Peaks functions (see the doc)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fixed">
   Fixed
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fooof">
   FOOOF
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#empirical-mode-decomposition">
   Empirical Mode Decomposition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#harmonic-recurrence">
   Harmonic recurrence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#endogeneous-inter-modulation-components">
   Endogeneous Inter-Modulation Components
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#effect-of-noise-on-peaks-detection">
   Effect of noise on peaks detection
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#we-will-now-quantify-the-effect-of-noise-on-peak-detection-by-plotting-the-performance-of-the-algorithms-for-different-intensity-of-noise">
     We will now quantify the effect of noise on peak detection by plotting the performance of the algorithms for different intensity of noise.
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="peaks-extraction-methods">
<h1>Peaks extraction methods<a class="headerlink" href="#peaks-extraction-methods" title="Permalink to this headline">#</a></h1>
<p>This notebook illustrates the use of the <em>biotuner</em> toolbox with the aims to show that we can retrieve harmonic information from a generated signal using different peaks extraction methods</p>
<p>This notebook is one step towards the exploration of biological harmonies and their relevance for the carving of new musical systems, as compared to pseudo-random generative engines.</p>
<div class="section" id="retrieving-frequency-information-from-simulated-signals-using-the-biotuner">
<h2>Retrieving frequency information from simulated signals using the biotuner<a class="headerlink" href="#retrieving-frequency-information-from-simulated-signals-using-the-biotuner" title="Permalink to this headline">#</a></h2>
<p>First, we will generate two signals composed of two sets of predetermined frequencies. The first one will contain harmonic frequencies, while the second will contain non-harmonic frequencies</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">biotuner.biotuner_utils</span> <span class="kn">import</span> <span class="n">generate_signal</span>
<span class="kn">from</span> <span class="nn">neurodsp.sim</span> <span class="kn">import</span> <span class="n">sim_combined</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>

<span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">length</span> <span class="o">=</span><span class="mi">4</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">freqs_harm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span>
<span class="n">freqs_noharm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">49</span><span class="p">]</span>
<span class="c1"># set amplitudes to random between 0.5 and 1</span>
<span class="n">amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs_harm</span><span class="p">))</span>
    
<span class="n">signal_harm</span> <span class="o">=</span> <span class="n">generate_signal</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">freqs_harm</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">signal_noharm</span> <span class="o">=</span> <span class="n">generate_signal</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">freqs_noharm</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Set up simulation parameters for neurodsp</span>
<span class="n">n_seconds</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">components_harm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sim_powerlaw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">},</span> 
    <span class="s1">&#39;sim_oscillation&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freqs_harm</span><span class="p">]</span>  <span class="c1"># list of dictionaries</span>
<span class="p">}</span>
<span class="n">components_noharm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sim_powerlaw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">},</span> 
    <span class="s1">&#39;sim_oscillation&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freqs_noharm</span><span class="p">]</span>  <span class="c1"># list of dictionaries</span>
<span class="p">}</span>

<span class="c1"># Each component (aperiodic &amp; oscillatory) needs a variance</span>
<span class="n">component_variances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs_noharm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>  <span class="c1"># +1 for the &#39;sim_powerlaw&#39; component</span>

<span class="c1"># Simulate the signal</span>
<span class="n">brain_signal_harm</span> <span class="o">=</span> <span class="n">sim_combined</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">components_harm</span><span class="p">,</span> <span class="n">component_variances</span><span class="p">)</span>
<span class="n">brain_signal_noharm</span> <span class="o">=</span> <span class="n">sim_combined</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">components_noharm</span><span class="p">,</span> <span class="n">component_variances</span><span class="p">)</span>

<span class="c1"># plot the signals with 2 rows of subplots</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># Create 2x2 subplots</span>

<span class="c1"># First row: Simulated oscillations</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">signal_harm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Harmonic signal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">signal_noharm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Non-harmonic signal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Second row: Simulated brain signals</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">brain_signal_harm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated Harmonic Brain Signal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">brain_signal_noharm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated Non-Harmonic Brain Signal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/peaks_extraction_3_0.png" src="../../_images/peaks_extraction_3_0.png" />
</div>
</div>
<p>Then, we want to retrieve the generator frequencies using different peaks_functions offered by the <em>biotuner</em>.</p>
</div>
<div class="section" id="peaks-functions-see-the-doc">
<h2>Peaks functions (<a class="reference external" href="https://github.com/AntoineBellemare/biotuner/blob/main/biotuner/biotuner_object.py">see the doc</a>)<a class="headerlink" href="#peaks-functions-see-the-doc" title="Permalink to this headline">#</a></h2>
<p><strong>fixed</strong> : ranges of frequency bands are fixed</p>
<p><strong>FOOOF</strong> : peaks rising above the aperiodic component</p>
<p><strong>EMD</strong>: Intrinsic Mode Functions (IMFs) are derived from Empirical Mode Decomposition (EMD)<br />
FFT is computed on each IMF</p>
<p><strong>harmonic_recurrence</strong>: keeps peaks for which a maximum of other peaks are harmonics</p>
<p><strong>EIMC</strong>: keeps peaks for which a maximum of other peaks are intermodulation components</p>
</div>
<div class="section" id="fixed">
<h2>Fixed<a class="headerlink" href="#fixed" title="Permalink to this headline">#</a></h2>
<p>And now with the <strong>‘fixed’</strong> bands method. With the specified bands, we would expect to find <em>2, 6</em> and <em>24Hz</em> for the harmonic signal and <em>2, 5</em> and <em>23Hz</em> for the non-harmonic signal</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.biotuner_object</span> <span class="kn">import</span> <span class="n">compute_biotuner</span>
<span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]]</span>
<span class="c1"># Initialize biotuner object for harmonic signal</span>
<span class="n">bt_harm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_harm</span><span class="p">,</span> <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Initialize biotuner object for non-harmonic signal</span>
<span class="n">bt_noharm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_noharm</span><span class="p">,</span> <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Compare results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_harm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NON-HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_noharm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/peaks_extraction_6_0.png" src="../../_images/peaks_extraction_6_0.png" />
<img alt="../../_images/peaks_extraction_6_1.png" src="../../_images/peaks_extraction_6_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HARMONIC PEAKS 
RETRIEVED [ 2.  6. 12. 24.] ORIGINAL [2, 6, 12, 18, 24, 36, 48]
NON-HARMONIC PEAKS 
RETRIEVED [ 2.  5. 11. 23.] ORIGINAL [2, 5, 11, 17, 23, 33, 49]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fooof">
<h2>FOOOF<a class="headerlink" href="#fooof" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object for harmonic signal</span>
<span class="n">bt_harm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_harm</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Initialize biotuner object for non-harmonic signal</span>
<span class="n">bt_noharm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_noharm</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Compare results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_harm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NON-HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_noharm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================================================================
                                                                                                  
                                   FOOOF - POWER SPECTRUM MODEL                                   
                                                                                                  
                        The model was run on the frequency range 0 - 50 Hz                        
                                 Frequency Resolution is 0.50 Hz                                  
                                                                                                  
                            Aperiodic Parameters (offset, exponent):                              
                                        -31.7637, -1.0123                                         
                                                                                                  
                                       7 peaks were found:                                        
                                CF:   2.00, PW: 36.313, BW:  1.06                                 
                                CF:   6.00, PW: 35.957, BW:  1.05                                 
                                CF:  12.00, PW: 36.079, BW:  1.05                                 
                                CF:  18.00, PW: 35.839, BW:  1.06                                 
                                CF:  24.00, PW: 35.479, BW:  1.04                                 
                                CF:  36.00, PW: 35.369, BW:  1.06                                 
                                CF:  48.00, PW: 35.189, BW:  1.03                                 
                                                                                                  
                                     Goodness of fit metrics:                                     
                                    R^2 of model fit is 0.9062                                    
                                    Error of the fit is 2.4452                                    
                                                                                                  
==================================================================================================
==================================================================================================
                                                                                                  
                                   FOOOF - POWER SPECTRUM MODEL                                   
                                                                                                  
                        The model was run on the frequency range 0 - 50 Hz                        
                                 Frequency Resolution is 0.50 Hz                                  
                                                                                                  
                            Aperiodic Parameters (offset, exponent):                              
                                        -31.5186, -0.5956                                         
                                                                                                  
                                       7 peaks were found:                                        
                                CF:   2.00, PW: 36.117, BW:  1.05                                 
                                CF:   5.00, PW: 35.849, BW:  1.06                                 
                                CF:  11.00, PW: 36.161, BW:  1.06                                 
                                CF:  17.00, PW: 36.145, BW:  1.05                                 
                                CF:  23.00, PW: 35.713, BW:  1.06                                 
                                CF:  33.00, PW: 35.769, BW:  1.07                                 
                                CF:  49.00, PW: 35.445, BW:  1.06                                 
                                                                                                  
                                     Goodness of fit metrics:                                     
                                    R^2 of model fit is 0.9128                                    
                                    Error of the fit is 2.3753                                    
                                                                                                  
==================================================================================================
HARMONIC PEAKS 
RETRIEVED [ 2. 12.  6. 18. 24.] ORIGINAL [2, 6, 12, 18, 24, 36, 48]
NON-HARMONIC PEAKS 
RETRIEVED [11. 17.  2.  5. 33.] ORIGINAL [2, 5, 11, 17, 23, 33, 49]
</pre></div>
</div>
<img alt="../../_images/peaks_extraction_8_1.png" src="../../_images/peaks_extraction_8_1.png" />
<img alt="../../_images/peaks_extraction_8_2.png" src="../../_images/peaks_extraction_8_2.png" />
</div>
</div>
</div>
<div class="section" id="empirical-mode-decomposition">
<h2>Empirical Mode Decomposition<a class="headerlink" href="#empirical-mode-decomposition" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object for harmonic signal</span>
<span class="n">bt_harm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span><span class="o">=</span><span class="s1">&#39;EMD&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_harm</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nIMFs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keep_first_IMF</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="p">)</span>

<span class="c1"># Initialize biotuner object for non-harmonic signal</span>
<span class="n">bt_noharm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span><span class="o">=</span><span class="s1">&#39;EMD&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_noharm</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nIMFs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keep_first_IMF</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="p">)</span>

<span class="c1"># Compare results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_harm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NON-HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_noharm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HARMONIC PEAKS 
RETRIEVED [ 2.  6. 18. 36.] ORIGINAL [2, 6, 12, 18, 24, 36, 48]
NON-HARMONIC PEAKS 
RETRIEVED [ 5. 11. 23. 49.] ORIGINAL [2, 5, 11, 17, 23, 33, 49]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="harmonic-recurrence">
<h2>Harmonic recurrence<a class="headerlink" href="#harmonic-recurrence" title="Permalink to this headline">#</a></h2>
<p>This method identifies spectral peaks that have the highest recurrence in the spectrum based on their harmonic series.
In the graph, each colored line reprensent a spectral peak, while the associated dashed lines represent harmonics of this peak.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object for harmonic signal</span>
<span class="n">bt_harm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> 

<span class="c1">#set figzise</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_harm</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">prominence</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Initialize biotuner object for non-harmonic signal</span>
<span class="n">bt_noharm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span><span class="o">=</span><span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_noharm</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">prominence</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Compare results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_harm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NON-HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_noharm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 500x200 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/peaks_extraction_12_1.png" src="../../_images/peaks_extraction_12_1.png" />
<img alt="../../_images/peaks_extraction_12_2.png" src="../../_images/peaks_extraction_12_2.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HARMONIC PEAKS 
RETRIEVED [ 2.  6. 12. 48.] ORIGINAL [2, 6, 12, 18, 24, 36, 48]
NON-HARMONIC PEAKS 
RETRIEVED [ 5.  2. 33. 11.] ORIGINAL [2, 5, 11, 17, 23, 33, 49]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="endogeneous-inter-modulation-components">
<h2>Endogeneous Inter-Modulation Components<a class="headerlink" href="#endogeneous-inter-modulation-components" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object for harmonic signal</span>
<span class="n">bt_harm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span><span class="o">=</span><span class="s1">&#39;EIMC&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_harm</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">n_peaks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Initialize biotuner object for non-harmonic signal</span>
<span class="n">bt_noharm</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span><span class="o">=</span><span class="s1">&#39;EIMC&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">signal_noharm</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">n_peaks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Round the peaks according to the precision, which is a float</span>
<span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks</span><span class="p">]</span>
<span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks</span><span class="p">]</span>

<span class="c1"># Compare results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_harm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_harm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NON-HARMONIC PEAKS&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RETRIEVED&#39;</span><span class="p">,</span> <span class="n">bt_noharm</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="s1">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="n">freqs_noharm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/peaks_extraction_14_0.png" src="../../_images/peaks_extraction_14_0.png" />
<img alt="../../_images/peaks_extraction_14_1.png" src="../../_images/peaks_extraction_14_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HARMONIC PEAKS 
RETRIEVED [12.0, 18.0, 6.0, 48.0] ORIGINAL [2, 6, 12, 18, 24, 36, 48]
NON-HARMONIC PEAKS 
RETRIEVED [11.0, 33.0, 49.0, 40.5] ORIGINAL [2, 5, 11, 17, 23, 33, 49]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="effect-of-noise-on-peaks-detection">
<h2>Effect of noise on peaks detection<a class="headerlink" href="#effect-of-noise-on-peaks-detection" title="Permalink to this headline">#</a></h2>
<p>We will add noise to the signal to see how the algorithms perform</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">welch</span>

<span class="c1"># Set a target channel noise power to something very noisy</span>
<span class="n">noise_db_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Create subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_db_list</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">db</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">noise_db_list</span><span class="p">):</span>
    <span class="c1"># Convert to linear Watt units</span>
    <span class="n">target_noise_watts</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">db</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Generate noise samples</span>
    <span class="n">mean_noise</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">noise_signal_harm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_noise</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">target_noise_watts</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal_harm</span><span class="p">))</span>
    <span class="n">noise_signal_brain_harm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_noise</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">target_noise_watts</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">brain_signal_harm</span><span class="p">))</span>

    <span class="c1"># Noise up the original signal (oscillations and brain signals) and plot</span>
    <span class="n">noised_signal_harm</span> <span class="o">=</span> <span class="n">signal_harm</span> <span class="o">+</span> <span class="n">noise_signal_harm</span>
    <span class="n">noised_brain_signal_harm</span> <span class="o">=</span> <span class="n">brain_signal_harm</span> <span class="o">+</span> <span class="n">noise_signal_brain_harm</span>
    
    <span class="c1"># For harmonic oscillation</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noised_signal_harm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">dB noise&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">welch</span><span class="p">(</span><span class="n">noised_signal_harm</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># For simulated brain signal</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noised_brain_signal_harm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">welch</span><span class="p">(</span><span class="n">noised_brain_signal_harm</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Set labels and titles</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Harmonic signal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated brain signal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PSD [V**2/Hz]&#39;</span><span class="p">)</span>

<span class="c1"># Add legends</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</pre></div>
</div>
<img alt="../../_images/peaks_extraction_16_1.png" src="../../_images/peaks_extraction_16_1.png" />
</div>
</div>
<div class="section" id="we-will-now-quantify-the-effect-of-noise-on-peak-detection-by-plotting-the-performance-of-the-algorithms-for-different-intensity-of-noise">
<h3>We will now quantify the effect of noise on peak detection by plotting the performance of the algorithms for different intensity of noise.<a class="headerlink" href="#we-will-now-quantify-the-effect-of-noise-on-peak-detection-by-plotting-the-performance-of-the-algorithms-for-different-intensity-of-noise" title="Permalink to this headline">#</a></h3>
<p>The first plot is for a signal made from a set of harmonic frequencies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">neurodsp.sim</span> <span class="kn">import</span> <span class="n">sim_combined</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">make_interp_spline</span><span class="p">,</span> <span class="n">BSpline</span>

<span class="c1"># Setting up parameters</span>
<span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">length</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_times</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1">#number of times the bootstraping is executed</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">36</span><span class="p">]</span>
<span class="n">amps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]]</span>

<span class="c1"># Simulate the signals</span>
<span class="n">components</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sim_powerlaw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> 
    <span class="s1">&#39;sim_oscillation&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>  <span class="c1"># list of dictionaries</span>
<span class="p">}</span>
<span class="n">component_variances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>  <span class="c1"># +1 for the &#39;sim_powerlaw&#39; component</span>

<span class="c1"># Simulate original signal</span>
<span class="n">simulated_EEG</span> <span class="o">=</span> <span class="n">sim_combined</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">component_variances</span><span class="p">)</span>

<span class="c1"># Simulate EEG signal</span>
<span class="n">simulated_oscillations</span> <span class="o">=</span> <span class="n">generate_signal</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;turquoise&#39;</span><span class="p">)</span>  <span class="c1"># Assuming generate_signal is your custom function</span>

<span class="n">signals</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Simulated Oscillations&#39;</span><span class="p">:</span> <span class="n">simulated_oscillations</span><span class="p">,</span> <span class="s1">&#39;Simulated EEG Signal&#39;</span><span class="p">:</span> <span class="n">simulated_EEG</span><span class="p">}</span>

<span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">peaks_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="s1">&#39;EIMC&#39;</span><span class="p">,</span> <span class="s1">&#39;EMD&#39;</span><span class="p">,</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">]</span>
    <span class="n">noise_db_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;deeppink&#39;</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">peaks_methods</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="n">median_distance_tot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">noise_db_list</span><span class="p">:</span> 
            <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">median_distance</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">n_times</span><span class="p">:</span>
                <span class="c1"># Convert to linear Watt units</span>
                <span class="n">target_noise_watts</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">db</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>

                <span class="c1"># Generate noise samples</span>
                <span class="n">mean_noise</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">noise_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_noise</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">target_noise_watts</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">))</span>

                <span class="c1"># Noise up the original signal</span>
                <span class="n">noised_signal</span> <span class="o">=</span> <span class="n">signal</span> <span class="o">+</span> <span class="n">noise_signal</span>
            
                <span class="c1"># set dictionary of prominence and rel_height for each method</span>
                <span class="n">prominences</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;EMD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;HH1D_max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;EIMC&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
                <span class="n">rel_heights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;EMD&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;HH1D_max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;EIMC&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
                <span class="c1"># Initialize biotuner object</span>
                <span class="n">biotuning</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;EMD&#39;</span><span class="p">:</span>
                    <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">noised_signal</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> 
                                        <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominences</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
                                        <span class="n">rel_height</span><span class="o">=</span><span class="n">rel_heights</span><span class="p">[</span><span class="n">method</span><span class="p">],</span> <span class="n">nIMFs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">keep_first_IMF</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                    <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># select only the first 4 peaks</span>
                    <span class="n">biotuning</span><span class="o">.</span><span class="n">peak</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">freqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">noised_signal</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> 
                                            <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominences</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
                                            <span class="n">rel_height</span><span class="o">=</span><span class="n">rel_heights</span><span class="p">[</span><span class="n">method</span><span class="p">],</span> <span class="n">nIMFs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">keep_first_IMF</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                        <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">freqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">db</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">no_noise_peaks</span> <span class="o">=</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">median_distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">list_distance</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span><span class="p">:</span>
                        <span class="n">takeClosest</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="p">,</span><span class="n">collection</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">num</span><span class="p">))</span>
                        <span class="n">closest</span> <span class="o">=</span> <span class="n">takeClosest</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">freqs</span><span class="p">)</span>
                        <span class="n">list_distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">closest</span><span class="p">))</span>   
                    <span class="n">median_distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">list_distance</span><span class="p">))</span>
                <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">median_distance_tot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">median_distance</span><span class="p">))</span> 
            <span class="c1"># calculate standard deviation</span>
            <span class="n">std_dev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">median_distance</span><span class="p">)</span>
                    <span class="c1"># Continue with your computations... </span>

            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">median_distance</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">median_distance</span><span class="p">)])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Method&quot;</span><span class="p">,</span> <span class="s2">&quot;Noise decibels&quot;</span><span class="p">,</span> <span class="s2">&quot;Median distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Std deviation&quot;</span><span class="p">])</span>

    <span class="c1"># Add the option for std or 95% CI</span>
    <span class="n">error_option</span> <span class="o">=</span> <span class="s1">&#39;CI&#39;</span>  <span class="c1"># change to &#39;std&#39; for standard deviation</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">peaks_methods</span><span class="p">:</span>
        <span class="n">df_method</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">method</span><span class="p">]</span>
        <span class="n">df_method</span> <span class="o">=</span> <span class="n">df_method</span><span class="p">[</span><span class="n">df_method</span><span class="p">[</span><span class="s1">&#39;Std deviation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
        
        <span class="c1"># To create smooth line plot</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">],</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Median distance&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: BSpline</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">spl</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">error_option</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span>
            <span class="n">spl_std</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">],</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Std deviation&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: BSpline</span>
            <span class="n">error_smooth</span> <span class="o">=</span> <span class="n">spl_std</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">error_option</span> <span class="o">==</span> <span class="s1">&#39;CI&#39;</span><span class="p">:</span>
            <span class="n">confidence_interval</span> <span class="o">=</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Std deviation&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.96</span>
            <span class="n">spl_ci</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">],</span> <span class="n">confidence_interval</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: BSpline</span>
            <span class="n">error_smooth</span> <span class="o">=</span> <span class="n">spl_ci</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>  <span class="c1"># use same color for the line</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>  <span class="c1"># get color of the line</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">y_smooth</span><span class="o">-</span><span class="n">error_smooth</span><span class="p">,</span> <span class="n">y_smooth</span><span class="o">+</span><span class="n">error_smooth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Impact of noise on peak detection: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Peak Extraction Method&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Median distance between generated and retrieved peaks&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fixed
harmonic_recurrence
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
EIMC
EMD
FOOOF
</pre></div>
</div>
<img alt="../../_images/peaks_extraction_18_1.png" src="../../_images/peaks_extraction_18_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fixed
harmonic_recurrence
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
EIMC
EMD
FOOOF
</pre></div>
</div>
<img alt="../../_images/peaks_extraction_18_3.png" src="../../_images/peaks_extraction_18_3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">neurodsp.sim</span> <span class="kn">import</span> <span class="n">sim_combined</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">make_interp_spline</span><span class="p">,</span> <span class="n">BSpline</span>

<span class="c1"># Setting up parameters</span>
<span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">length</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_times</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1">#number of times the bootstraping is executed</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">15.5</span><span class="p">,</span> <span class="mf">18.3</span><span class="p">,</span> <span class="mf">24.9</span><span class="p">,</span> <span class="mf">39.1</span><span class="p">]</span>
<span class="n">amps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]]</span>

<span class="c1"># Simulate the signals</span>
<span class="n">components</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sim_powerlaw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> 
    <span class="s1">&#39;sim_oscillation&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>  <span class="c1"># list of dictionaries</span>
<span class="p">}</span>
<span class="n">component_variances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>  <span class="c1"># +1 for the &#39;sim_powerlaw&#39; component</span>

<span class="c1"># Simulate original signal</span>
<span class="n">simulated_EEG</span> <span class="o">=</span> <span class="n">sim_combined</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">component_variances</span><span class="p">)</span>

<span class="c1"># Simulate EEG signal</span>
<span class="n">simulated_oscillations</span> <span class="o">=</span> <span class="n">generate_signal</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;turquoise&#39;</span><span class="p">)</span>  <span class="c1"># Assuming generate_signal is your custom function</span>

<span class="n">signals</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Simulated Oscillations&#39;</span><span class="p">:</span> <span class="n">simulated_oscillations</span><span class="p">,</span> <span class="s1">&#39;Simulated EEG Signal&#39;</span><span class="p">:</span> <span class="n">simulated_EEG</span><span class="p">}</span>

<span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">peaks_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="s1">&#39;EIMC&#39;</span><span class="p">,</span> <span class="s1">&#39;EMD&#39;</span><span class="p">,</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">]</span>
    <span class="n">noise_db_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;deeppink&#39;</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">peaks_methods</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="n">median_distance_tot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">noise_db_list</span><span class="p">:</span> 
            <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">median_distance</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">n_times</span><span class="p">:</span>
                <span class="c1"># Convert to linear Watt units</span>
                <span class="n">target_noise_watts</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">db</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>

                <span class="c1"># Generate noise samples</span>
                <span class="n">mean_noise</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">noise_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_noise</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">target_noise_watts</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">))</span>

                <span class="c1"># Noise up the original signal</span>
                <span class="n">noised_signal</span> <span class="o">=</span> <span class="n">signal</span> <span class="o">+</span> <span class="n">noise_signal</span>
            
                <span class="c1"># set dictionary of prominence and rel_height for each method</span>
                <span class="n">prominences</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;EMD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;HH1D_max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;EIMC&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
                <span class="n">rel_heights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;EMD&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;FOOOF&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;HH1D_max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;EIMC&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
                <span class="c1"># Initialize biotuner object</span>
                <span class="n">biotuning</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="n">sf</span><span class="p">,</span> <span class="n">peaks_function</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;EMD&#39;</span><span class="p">:</span>
                    <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">noised_signal</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> 
                                        <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominences</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
                                        <span class="n">rel_height</span><span class="o">=</span><span class="n">rel_heights</span><span class="p">[</span><span class="n">method</span><span class="p">],</span> <span class="n">nIMFs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">keep_first_IMF</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                    <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># select only the first 4 peaks</span>
                    <span class="n">biotuning</span><span class="o">.</span><span class="n">peak</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">freqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">noised_signal</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> 
                                            <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominences</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
                                            <span class="n">rel_height</span><span class="o">=</span><span class="n">rel_heights</span><span class="p">[</span><span class="n">method</span><span class="p">],</span> <span class="n">nIMFs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">keep_first_IMF</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                        <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">freqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">db</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">no_noise_peaks</span> <span class="o">=</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">median_distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">list_distance</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span><span class="p">:</span>
                        <span class="n">takeClosest</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="p">,</span><span class="n">collection</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">num</span><span class="p">))</span>
                        <span class="n">closest</span> <span class="o">=</span> <span class="n">takeClosest</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">freqs</span><span class="p">)</span>
                        <span class="n">list_distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">closest</span><span class="p">))</span>   
                    <span class="n">median_distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">list_distance</span><span class="p">))</span>
                <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">median_distance_tot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">median_distance</span><span class="p">))</span> 
            <span class="c1"># calculate standard deviation</span>
            <span class="n">std_dev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">median_distance</span><span class="p">)</span>
                    <span class="c1"># Continue with your computations... </span>

            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">median_distance</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">median_distance</span><span class="p">)])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Method&quot;</span><span class="p">,</span> <span class="s2">&quot;Noise decibels&quot;</span><span class="p">,</span> <span class="s2">&quot;Median distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Std deviation&quot;</span><span class="p">])</span>

    <span class="c1"># Add the option for std or 95% CI</span>
    <span class="n">error_option</span> <span class="o">=</span> <span class="s1">&#39;CI&#39;</span>  <span class="c1"># change to &#39;std&#39; for standard deviation</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">peaks_methods</span><span class="p">:</span>
        <span class="n">df_method</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">method</span><span class="p">]</span>
        <span class="n">df_method</span> <span class="o">=</span> <span class="n">df_method</span><span class="p">[</span><span class="n">df_method</span><span class="p">[</span><span class="s1">&#39;Std deviation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
        
        <span class="c1"># To create smooth line plot</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">],</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Median distance&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: BSpline</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">spl</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">error_option</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span>
            <span class="n">spl_std</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">],</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Std deviation&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: BSpline</span>
            <span class="n">error_smooth</span> <span class="o">=</span> <span class="n">spl_std</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">error_option</span> <span class="o">==</span> <span class="s1">&#39;CI&#39;</span><span class="p">:</span>
            <span class="n">confidence_interval</span> <span class="o">=</span> <span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Std deviation&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.96</span>
            <span class="n">spl_ci</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df_method</span><span class="p">[</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">],</span> <span class="n">confidence_interval</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: BSpline</span>
            <span class="n">error_smooth</span> <span class="o">=</span> <span class="n">spl_ci</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>  <span class="c1"># use same color for the line</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>  <span class="c1"># get color of the line</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">y_smooth</span><span class="o">-</span><span class="n">error_smooth</span><span class="p">,</span> <span class="n">y_smooth</span><span class="o">+</span><span class="n">error_smooth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Impact of noise on peak detection: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Peak Extraction Method&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Noise decibels&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Median distance&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fixed
harmonic_recurrence
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
EIMC
EMD
FOOOF
</pre></div>
</div>
<img alt="../../_images/peaks_extraction_19_1.png" src="../../_images/peaks_extraction_19_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fixed
harmonic_recurrence
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
No peaks were detected. Consider increasing precision or number of harmonics
No peak detected
EIMC
EMD
FOOOF
</pre></div>
</div>
<img alt="../../_images/peaks_extraction_19_3.png" src="../../_images/peaks_extraction_19_3.png" />
</div>
</div>
<p>The second plot is for a signal made from a set of inharmonic frequencies.</p>
</div>
</div>
</div>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../biotuner_MNE/biotuner_MNE.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Harmonicity Metrics Computation on MNE Epochs File</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../harmonicity_metrics/harmonicity_metrics.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Harmonicity metrics</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Antoine Bellemare & François Lespinasse. This documentation is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> license.<br/>
  
      &copy; Copyright 2023–2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>