
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Constructing musical tunings with biosignals &#8212; Biotuner 0.0.1 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/example_gallery_styles.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Deriving spectral chords from biosignals" href="../spectral_chords/spectral_chords.html" />
    <link rel="prev" title="From Spectral Peaks to Harmonic Spectrum Analysis" href="../harmonic_spectrum/harmonic_spectrum.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Biotuner 0.0.1 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Menu:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started.html">
   Getting started with Biotuner
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cite_us.html">
   Cite us
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../biotuner_MNE/biotuner_MNE.html">
     Harmonicity Metrics Computation on MNE Epochs File
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../peaks_extraction/peaks_extraction.html">
     Peaks extraction methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../harmonicity_metrics/harmonicity_metrics.html">
     Harmonicity metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../harmonic_spectrum/harmonic_spectrum.html">
     From Spectral Peaks to Harmonic Spectrum Analysis
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Constructing musical tunings with biosignals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spectral_chords/spectral_chords.html">
     Deriving spectral chords from biosignals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rhythm_construction/rhythm_construction.html">
     Constructing euclidian rhythms from biotunings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../phase_amplitude_coupling/phase_amplitude_coupling.html">
     Phase-Amplitude Coupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../api/index.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/biotuner_object.html">
     Biotuner object
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/metrics.html">
     Harmonicity Metrics
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/harmonic_spectrum.html">
     Harmonic spectrum
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/harmonic_connectivity.html">
     Harmonic connectivity
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/peaks_extension.html">
     Peaks Extension
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/peaks_extraction.html">
     Peaks Extraction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/rhythm_construction.html">
     Rhythm construction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/scale_construction.html">
     Scale construction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../api/utils.html">
     Biotuner utilities
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/examples/scale_construction/scale_construction.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-content">
   Table of content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spectral-peaks-extraction">
   1. Spectral peaks extraction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-dataset">
     Load dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extract-spectral-peaks">
     Extract spectral peaks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-tuning-from-peaks-ratios">
   2. Deriving tuning from peaks ratios
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dissonance-curve">
   3. Dissonance curve
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#harmonic-entropy">
   4. Harmonic entropy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classical-tuning-creation">
   5. Classical tuning creation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euler-fokker-genera">
     5.1. Euler-Fokker Genera
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonic-scale">
     5.2. Harmonic scale
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-harmonic-recurrence">
       5.2.1. Using harmonic recurrence
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-inter-harmonic-concordance">
       5.2.2. Using inter-harmonic concordance
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scale-from-generator-interval">
   5.3. Scale from generator interval
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scale-reduction">
   6. Scale reduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scale-from-multiple-time-series">
   7. Scale from multiple time series
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-dissonance-curves">
     Multiple dissonance curves
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exporting-scale-in-scala-format">
   8. Exporting scale in scala format
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-consonance-matrix-for-a-specific-scale">
   9. Plotting consonance matrix for a specific scale
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-scale-metrics">
   10. Computing scale metrics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-peaks-ratios">
     From peaks ratios
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-harmonic-entropy-tuning">
     From harmonic entropy tuning
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-ratios-with-lissajous-curves">
   11. Visualizing ratios with Lissajous curves
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#listening-to-scales">
   12. Listening to scales
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Constructing musical tunings with biosignals</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-content">
   Table of content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spectral-peaks-extraction">
   1. Spectral peaks extraction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-dataset">
     Load dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extract-spectral-peaks">
     Extract spectral peaks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-tuning-from-peaks-ratios">
   2. Deriving tuning from peaks ratios
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dissonance-curve">
   3. Dissonance curve
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#harmonic-entropy">
   4. Harmonic entropy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classical-tuning-creation">
   5. Classical tuning creation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euler-fokker-genera">
     5.1. Euler-Fokker Genera
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonic-scale">
     5.2. Harmonic scale
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-harmonic-recurrence">
       5.2.1. Using harmonic recurrence
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-inter-harmonic-concordance">
       5.2.2. Using inter-harmonic concordance
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scale-from-generator-interval">
   5.3. Scale from generator interval
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scale-reduction">
   6. Scale reduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scale-from-multiple-time-series">
   7. Scale from multiple time series
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-dissonance-curves">
     Multiple dissonance curves
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exporting-scale-in-scala-format">
   8. Exporting scale in scala format
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-consonance-matrix-for-a-specific-scale">
   9. Plotting consonance matrix for a specific scale
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-scale-metrics">
   10. Computing scale metrics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-peaks-ratios">
     From peaks ratios
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-harmonic-entropy-tuning">
     From harmonic entropy tuning
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-ratios-with-lissajous-curves">
   11. Visualizing ratios with Lissajous curves
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#listening-to-scales">
   12. Listening to scales
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="section" id="constructing-musical-tunings-with-biosignals">
<h1>Constructing musical tunings with biosignals<a class="headerlink" href="#constructing-musical-tunings-with-biosignals" title="Permalink to this headline">#</a></h1>
<p>This notebook is intended to demonstrate the use of the biotuner for tuning construction. To do so, we will explore how different tuning construction methods developed in the field of music theory can be integrated with electrophysiological signal processing techniques.</p>
<p>The terms ‘’<em>tuning</em>’’ and ‘’<em>scale</em>’’ will be used interchangeably, referring to a series of ratios that subdivides an octave.</p>
<div class="section" id="table-of-content">
<h2>Table of content<a class="headerlink" href="#table-of-content" title="Permalink to this headline">#</a></h2>
<ol>
<li><p><a class="reference external" href="#1-spectral-peaks-extraction">Spectral peaks extraction</a></p></li>
<li><p><a class="reference external" href="#2-deriving-tuning-from-peaks-ratios">Deriving tuning from peaks ratios</a></p></li>
<li><p><a class="reference external" href="#3-dissonance-curve">Dissonance curve</a></p></li>
<li><p><a class="reference external" href="#4-harmonic-entropy">Harmonic entropy</a></p></li>
<li><p><a class="reference external" href="#5-classical-tuning-creation">Classical tuning creation</a></p>
<p>5.1. <a class="reference external" href="#51-euler-fokker-genera">Euler-Fokker Genera</a></p>
<p>5.2. <a class="reference external" href="#52-harmonic-scale">Harmonic scale</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> 5.2.1. Using harmonic recurrence
 5.2.2. Using inter-harmonic concordance
</pre></div>
</div>
</li>
<li><p><a class="reference external" href="#6-scale-reduction">Scale reduction</a></p></li>
<li><p><a class="reference external" href="#7-scale-from-multiple-time-series">Scale from multiple time series</a></p></li>
<li><p><a class="reference external" href="#8-exporting-scale-in-scala-format">Exporting scale in scala format</a></p></li>
<li><p><a class="reference external" href="#9-plotting-consonance-matrix-for-a-specific-scale">Plotting consonance matrix for a specific scale</a></p></li>
<li><p><a class="reference external" href="#10-computing-scale-metrics">Computing scale metrics</a></p></li>
<li><p><a class="reference external" href="#11-visualizing-ratios-with-lissajous-curves">Visualizing ratios with Lissajous curves</a></p></li>
<li><p><a class="reference external" href="#12-listening-to-scales">Listening to scales</a></p></li>
</ol>
</div>
<div class="section" id="spectral-peaks-extraction">
<h2>1. Spectral peaks extraction<a class="headerlink" href="#spectral-peaks-extraction" title="Permalink to this headline">#</a></h2>
<div class="section" id="load-dataset">
<h3>Load dataset<a class="headerlink" href="#load-dataset" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pytuning.visualizations.scales</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;../data/EEG_example.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="extract-spectral-peaks">
<h3>Extract spectral peaks<a class="headerlink" href="#extract-spectral-peaks" title="Permalink to this headline">#</a></h3>
<p>The first step is to initialize the biotuner object by calling <em>compute_biotuner</em> and then applying the method <em>peaks_extraction</em>.</p>
<p>The <em>peaks_function</em> argument determines how spectral peaks are extracted. Here the ‘fixed’ method is used, where predetermined frequency bands are used to find one spectral peak associated with each band.</p>
<p>There is no minimum size for time series. However, keep in mind that the minimum frequency that can be observed using spectral decomposition is dependant on the length of your time series. For example, if the sampling frequency equals 1000Hz, time series shorter than 1 second will not allow for peak extraction below 2Hz. Also, note that the <em>precision</em> argument influences the size of the fft and higher precision requires longer time series (e.g. 0.1Hz of precision at 1000Hz of sampling frequency requires 10 seconds of signal).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">biotuner.biotuner_object</span> <span class="kn">import</span> <span class="n">compute_biotuner</span>
<span class="c1"># Define frequency bands for peaks_function = &#39;fixed&#39;</span>
<span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">45</span><span class="p">]]</span> 

<span class="c1"># Select a single time series</span>
<span class="n">data_</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Initialize biotuner object</span>
<span class="n">biotuning</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Extract spectral peaks</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                          <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">stop</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stop</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.001957416534423828
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the extracted peaks</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">peaks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1.5,  5. ,  8. , 13. , 19. , 30.5])
</pre></div>
</div>
</div>
</div>
<p>Now that we have shown how spectral peaks can be extracted, we will use these peaks as the basis for the organisation of musical structures. We will show how to derive tunings based on the harmonicity of spectral peaks, expressed as the simplicity of their frequency ratios.</p>
</div>
</div>
<div class="section" id="deriving-tuning-from-peaks-ratios">
<h2>2. Deriving tuning from peaks ratios<a class="headerlink" href="#deriving-tuning-from-peaks-ratios" title="Permalink to this headline">#</a></h2>
<p>The simpliest way to derive a tuning from spectral peaks is to use their ratios as steps for dividing the octave. An attribute of the biotuner object provides this information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_ratios</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.0833333333333333,
 1.1730769230769231,
 1.1875,
 1.2708333333333333,
 1.3,
 1.3333333333333333,
 1.4615384615384615,
 1.525,
 1.5833333333333333,
 1.6,
 1.605263157894737,
 1.625,
 1.6666666666666667,
 1.9,
 1.90625]
</pre></div>
</div>
</div>
</div>
<p>You can also derive a tuning from extended peaks ratios as well as from extended peaks ratios with higher consonance levels. Extended peaks correspond to a set of frequencies based on the harmonic congruence of spectral peaks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">harm_function</span> <span class="o">=</span> <span class="s1">&#39;mult&#39;</span><span class="p">,</span>  <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> 
                          <span class="n">cons_limit</span> <span class="o">=</span> <span class="mf">0.129</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.129</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">extended_peaks_ratios</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of extended peaks :  16
[1.01 1.02 1.03 1.05 1.07 1.08 1.09 1.15 1.17 1.19 1.2  1.23 1.25 1.26
 1.27 1.29 1.3  1.31 1.33 1.35 1.37 1.46 1.48 1.5  1.52 1.54 1.56 1.58
 1.6  1.61 1.62 1.67 1.7  1.71 1.73 1.83 1.85 1.88 1.9  1.91 1.93 1.98
 2.  ]
</pre></div>
</div>
</div>
</div>
<p>Since the tuning from extended peaks might have a large number of steps, we could keep only the most consonant ratios. To do so, we adjust the ‘scale_cons_limit’ value:</p>
<p>Comparisons with familiar ratios:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    #Unison-frequency ratio 1:1 yields a value of 2
    Octave-frequency ratio 2:1 yields a value of 1.5
    Perfect 5th-frequency ratio 3:2 yields a value of 0.833
    Perfect 4th-frequency ratio 4:3 yields a value of 0.583
    Major 6th-frequency ratio 5:3 yields a value of 0.533
    Major 3rd-frequency ratio 5:4 yields a value of 0.45
    Minor 3rd-frequency ratio 5:6 yields a value of 0.366
    Minor 6th-frequency ratio 5:8 yields a value of 0.325
    Major 2nd-frequency ratio 8:9 yields a value of 0.236
    Major 7th-frequency ratio 8:15 yields a value of 0.192
    Minor 7th-frequency ratio 9:16 yields a value of 0.174
    Minor 2nd-frequency ratio 15:16 yields a value of 0.129
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">harm_function</span> <span class="o">=</span> <span class="s1">&#39;mult&#39;</span><span class="p">,</span>  <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> 
                          <span class="n">cons_limit</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.129</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">extended_peaks_ratios_cons</span><span class="p">)</span>

<span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">harm_function</span> <span class="o">=</span> <span class="s1">&#39;mult&#39;</span><span class="p">,</span>  <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> 
                          <span class="n">cons_limit</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.236</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">extended_peaks_ratios_cons</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of extended peaks :  21
[1.083 1.125 1.154 1.2   1.231 1.25  1.3   1.333 1.444 1.462 1.5   1.583
 1.6   1.625 1.667 1.778 1.875 1.9   2.   ]
Number of extended peaks :  21
[1.125 1.2   1.25  1.333 1.5   1.6   1.667 2.   ]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dissonance-curve">
<h2>3. Dissonance curve<a class="headerlink" href="#dissonance-curve" title="Permalink to this headline">#</a></h2>
<p>The dissonance curve has been introduced by William Sethares showing how the harmonic structure that constitutes a timbre can be reflected in scale construction, allowing to find tunings that will match the timbral structure. I strongly recommend reading his book <a class="reference external" href="https://sethares.engr.wisc.edu/ttss.html">Tuning, Timbre, Spectrum and Scale</a>.</p>
<p>The dissonance curve takess as input list of peaks and their associated amplitudes. Since providing less than 6 spectral peaks would lead to less interesting dissonance curve, the method ‘’peaks_extension’’ provides a way to extend the number of peaks based on the harmonic_fit function (see biotuner.py)</p>
<p>peaks_extension methods:
[‘harmonic_fit’, ‘consonant’, ‘multi_consonant’, ‘consonant_harmonic_fit’, ‘multi_consonant_harmonic_fit’]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extend spectral peaks based on their inter-harmonic concordance</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">harm_function</span> <span class="o">=</span> <span class="s1">&#39;mult&#39;</span><span class="p">,</span>  <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">cons_limit</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> 
                          <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># Compute the dissonance curve</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">compute_diss_curve</span><span class="p">(</span><span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">input_type</span> <span class="o">=</span> <span class="s1">&#39;extended_peaks&#39;</span><span class="p">,</span> <span class="n">euler_comp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">max_ratio</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_tet_grid</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of extended peaks :  16
</pre></div>
</div>
<img alt="../../_images/scale_construction_17_1.png" src="../../_images/scale_construction_17_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dissonance curve metrics:&#39;</span><span class="p">,</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">scale_metrics</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dissonance curve tuning:&#39;</span><span class="p">,</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">diss_scale</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dissonance curve consonant tuning:&#39;</span><span class="p">,</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">diss_scale_cons</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dissonance curve metrics: {&#39;diss_euler&#39;: &#39;NaN&#39;, &#39;dissonance&#39;: 5.9114886117207055, &#39;diss_harm_sim&#39;: 14.059883388112603, &#39;diss_n_steps&#39;: 18}
Dissonance curve tuning: [1.0952380952380953, 1.1538461538461537, 1.1868131868131868, 1.2307692307692308, 1.25, 1.2659574468085106, 1.3, 1.3111111111111111, 1.3333333333333333, 1.3970588235294117, 1.4606741573033708, 1.6, 1.6236559139784945, 1.6666666666666667, 1.8450704225352113, 1.8736842105263158, 1.898989898989899, 2.0]
Dissonance curve consonant tuning: [1.154 1.231 1.25  1.3   1.333 1.6   1.667 2.   ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.biotuner_utils</span> <span class="kn">import</span> <span class="n">scale2frac</span>

<span class="c1">### If you want the tuning in fraction</span>
<span class="n">scale_frac</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">scale2frac</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">diss_scale</span><span class="p">,</span> <span class="n">maxdenom</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">scale_frac</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23/21,
 15/13,
 108/91,
 16/13,
 5/4,
 119/94,
 13/10,
 59/45,
 4/3,
 95/68,
 130/89,
 8/5,
 151/93,
 5/3,
 131/71,
 178/95,
 188/99,
 2]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="harmonic-entropy">
<h2>4. Harmonic entropy<a class="headerlink" href="#harmonic-entropy" title="Permalink to this headline">#</a></h2>
<p><span class="xref myst">Harmonic entropy</span> is a simple model to quantify the extent to which musical chords exhibit various psychoacoustic effects, lumped together in a single construct called psychoacoustic concordance.</p>
<p>The <em>compute_harmonic_entropy</em> method takes as input a list of ratios.</p>
<p>If <em>input_type</em> is set to ‘<em>peaks</em>’ or <em>‘extended_peaks’</em>, their ratios will be used.
Other input types use extended ratios : see biotuner ref.</p>
<p>‘extended_ratios_inc’  (increments of the ratios in the form of <em>r^1, r^2, r^3, … r^n</em>)</p>
<p>‘extended_ratios_inc_fit’ (harmonic fit between the ratios increments)</p>
<p>‘extended_ratios_harm’ (harmonics of the ratios in the form <em>rx1, rx2, rx3, … rxn</em>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object, specifying that you want ratios increments and harmonics to be computed</span>
<span class="n">biotuning</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
                             <span class="n">ratios_inc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ratios_harms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ratios_inc_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Extract spectral peaks</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n_peaks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                          <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_harms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># compute the extended peaks by finding inter-harmonic concordance.</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">harm_function</span> <span class="o">=</span> <span class="s1">&#39;mult&#39;</span><span class="p">,</span>  <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> 
                          <span class="n">cons_limit</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1"># compute the harmonic entropy curve as a function of extended ratios increments.</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">compute_harmonic_entropy</span><span class="p">(</span><span class="n">input_type</span> <span class="o">=</span> <span class="s1">&#39;extended_ratios_inc&#39;</span><span class="p">,</span> <span class="n">plot_entropy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">octave</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rebound</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                                   <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># compute the harmonic entropy curve as a function of extended ratios harmonics.</span>
<span class="n">biotuning</span><span class="o">.</span><span class="n">compute_harmonic_entropy</span><span class="p">(</span><span class="n">input_type</span> <span class="o">=</span> <span class="s1">&#39;extended_ratios_harms&#39;</span><span class="p">,</span> <span class="n">plot_entropy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">octave</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rebound</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                                   <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of extended peaks :  20
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">harm_function</span> <span class="o">=</span> <span class="s1">&#39;mult&#39;</span><span class="p">,</span>  <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">9</span>                           <span class="n">cons_limit</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># compute the harmonic entropy curve as a function of extended ratios increments.</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">compute_harmonic_entropy</span><span class="p">(</span><span class="n">input_type</span> <span class="o">=</span> <span class="s1">&#39;extended_ratios_inc&#39;</span><span class="p">,</span> <span class="n">plot_entropy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">octave</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rebound</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
<span class="g g-Whitespace">     </span><span class="mi">12</span>                                    <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># compute the harmonic entropy curve as a function of extended ratios harmonics.</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">compute_harmonic_entropy</span><span class="p">(</span><span class="n">input_type</span> <span class="o">=</span> <span class="s1">&#39;extended_ratios_harms&#39;</span><span class="p">,</span> <span class="n">plot_entropy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">octave</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rebound</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
<span class="g g-Whitespace">     </span><span class="mi">16</span>                                    <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nn">File ~/git/biotuner/biotuner/biotuner_object.py:996,</span> in <span class="ni">compute_biotuner.compute_harmonic_entropy</span><span class="nt">(self, input_type, res, spread, plot_entropy, plot_tenney, octave, rebound, sub, scale_cons_limit)</span>
<span class="g g-Whitespace">    </span><span class="mi">993</span> <span class="k">if</span> <span class="n">scale_cons_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">994</span>     <span class="n">scale_cons_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_cons_limit</span>
<span class="ne">--&gt; </span><span class="mi">996</span> <span class="n">HE_scale</span><span class="p">,</span> <span class="n">HE</span> <span class="o">=</span> <span class="n">harmonic_entropy</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">997</span>     <span class="n">ratios</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">998</span>     <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">999</span>     <span class="n">spread</span><span class="o">=</span><span class="n">spread</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1000</span>     <span class="n">plot_entropy</span><span class="o">=</span><span class="n">plot_entropy</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1001</span>     <span class="n">plot_tenney</span><span class="o">=</span><span class="n">plot_tenney</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1002</span>     <span class="n">octave</span><span class="o">=</span><span class="n">octave</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1003</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1004</span> <span class="bp">self</span><span class="o">.</span><span class="n">HE_scale</span> <span class="o">=</span> <span class="n">HE_scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1005</span> <span class="bp">self</span><span class="o">.</span><span class="n">HE_scale_cons</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">consonant_ratios</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1006</span>     <span class="bp">self</span><span class="o">.</span><span class="n">HE_scale</span><span class="p">,</span> <span class="n">scale_cons_limit</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="s2">&quot;ratios&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1007</span> <span class="p">)</span>

<span class="nn">File ~/git/biotuner/biotuner/scale_construction.py:704,</span> in <span class="ni">harmonic_entropy</span><span class="nt">(ratios, res, spread, plot_entropy, plot_tenney, octave)</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="n">ratios</span> <span class="o">=</span> <span class="n">numerators</span> <span class="o">/</span> <span class="n">denominators</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span> <span class="n">bendetti_heights</span> <span class="o">=</span> <span class="n">numerators</span> <span class="o">*</span> <span class="n">denominators</span>
<span class="ne">--&gt; </span><span class="mi">704</span> <span class="n">tenney_heights</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">bendetti_heights</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">tenney_heights</span><span class="p">)</span>  <span class="c1"># sort by Tenney height</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span> <span class="n">bendetti_heights</span> <span class="o">=</span> <span class="n">bendetti_heights</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

<span class="ne">TypeError</span>: only size-1 arrays can be converted to Python scalars
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Harmonic entropy metrics:&#39;</span><span class="p">,</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">scale_metrics</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Harmonic entropy tuning:&#39;</span><span class="p">,</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">HE_scale</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Harmonic entropy consonant tuning:&#39;</span><span class="p">,</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">HE_scale_cons</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Harmonic entropy metrics: {&#39;HE&#39;: 1.2165484571397156, &#39;HE_n_steps&#39;: 21, &#39;HE_harm_sim&#39;: 0.5818470682340359}
Harmonic entropy tuning: [1.018 1.036 1.07  1.101 1.122 1.196 1.266 1.283 1.315 1.349 1.379 1.451
 1.494 1.57  1.603 1.646 1.71  1.792 1.818 1.927 1.967]
Harmonic entropy consonant tuning: [1.07  1.57  1.71  1.792]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you want the tuning in fraction</span>
<span class="n">scale_frac</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">scale2frac</span> <span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">HE_scale</span><span class="p">,</span> <span class="n">maxdenom</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scale_frac</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57/56, 86/83, 107/100, 109/99, 46/41, 61/51, 119/94, 68/53, 96/73, 58/43, 131/95, 74/51, 124/83, 157/100, 109/68, 107/65, 171/100, 138/77, 20/11, 185/96, 179/91]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="classical-tuning-creation">
<h2>5. Classical tuning creation<a class="headerlink" href="#classical-tuning-creation" title="Permalink to this headline">#</a></h2>
<p>We will see in this section how to use spectral peaks and their ratios to derive tunings based on Euler-Fokker Genera, Harmonic positions and Generator Intervals</p>
<div class="section" id="euler-fokker-genera">
<h3>5.1. Euler-Fokker Genera<a class="headerlink" href="#euler-fokker-genera" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Euler%E2%80%93Fokker_genus">Euler-Fokker genera</a> are musical scale in just intonation whose pitches can be expressed as products of some of the members of some multiset of generating prime factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object</span>
<span class="n">BT_EFG</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                                          <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">ratios_n_harms</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">ratios_inc_fit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                          <span class="n">ratios_inc</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Extract spectral peaks</span>
<span class="n">BT_EFG</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Use peaks as generators (using method)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generators :&#39;</span><span class="p">,</span> <span class="n">BT_EFG</span><span class="o">.</span><span class="n">peaks</span><span class="p">)</span>
<span class="n">BT_EFG</span><span class="o">.</span><span class="n">euler_fokker_scale</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of peaks : 5
Generators : [ 2.   6.5  8.   3.5 11.5]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 33/32, 11/8, 3/2, 2]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.scale_construction</span> <span class="kn">import</span> <span class="n">euler_fokker_scale</span>
<span class="kn">from</span> <span class="nn">biotuner.biotuner_utils</span> <span class="kn">import</span> <span class="n">scale_interval_names</span>

<span class="c1"># compute extended peaks</span>
<span class="n">BT_EFG</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">harm_function</span> <span class="o">=</span> <span class="s1">&#39;mult&#39;</span><span class="p">,</span> 
                                       <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">cons_limit</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Use extended peaks as generators (using function)</span>
<span class="n">EFG_scale</span> <span class="o">=</span> <span class="n">euler_fokker_scale</span><span class="p">(</span><span class="n">BT_EFG</span><span class="o">.</span><span class="n">extended_peaks</span><span class="p">)</span>

<span class="c1"># print the scale steps with associated names</span>
<span class="n">scale_interval_names</span><span class="p">(</span><span class="n">EFG_scale</span><span class="p">,</span> <span class="n">reduce</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of extended peaks :  8
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1, &#39;Unison&#39;],
 [33/32, &#39;Thrty-third Harmonic&#39;],
 [9/8, &#39;Pythagorean Major Second&#39;],
 [77/64, &#39;Seventy-seventh Harmonic&#39;],
 [21/16, &#39;21st Harmonic&#39;],
 [693/512, None],
 [11/8, &#39;Eleventh Harmonic&#39;],
 [3/2, &#39;Perfect Fifth&#39;],
 [99/64, &#39;Ninety-ninth Harmonic&#39;],
 [7/4, &#39;Septimal Minor Seventh&#39;],
 [231/128, None],
 [63/32, &#39;Sixty-third Harmonic&#39;],
 [2, &#39;Octave&#39;]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="harmonic-scale">
<h3>5.2. Harmonic scale<a class="headerlink" href="#harmonic-scale" title="Permalink to this headline">#</a></h3>
<p>Harmonic scales are constructed by transforming a set of harmonic positions into ratios falling between the unison (1) and the octave (2). For example, using the harmonics 3, 5 and 7 would yields a scale of 1, 1.5, 1.25 and 1.75, since 3/2=1.5, 5/2^2 = 1.25 and 7/2^2 = 1.75</p>
<div class="section" id="using-harmonic-recurrence">
<h4>5.2.1. Using harmonic recurrence<a class="headerlink" href="#using-harmonic-recurrence" title="Permalink to this headline">#</a></h4>
<p>The harmonic recurrence method computes all peaks of the spectrum, and keeps peaks for which a maximum of other peaks are harmonics. This method gives as an ouput the peaks and the positions of congruent harmonics. The <em>max_freq</em> argument determines the maximum frequency that can be choose as a peak. The <em>min_harms</em> argument indicates the minimum number of congruent harmonics to keep the peak.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object</span>
<span class="n">biotuning_harm_peaks</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks with minimum of 2 recurrent harmonics</span>
<span class="n">biotuning_harm_peaks</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">min_harms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">biotuning_harm_peaks</span><span class="o">.</span><span class="n">all_harmonics</span><span class="p">)</span>

<span class="c1"># Extract spectral peaks with minimum of 4 recurrent harmonics</span>
<span class="n">biotuning_harm_peaks</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">min_harms</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">harm_limit</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">biotuning_harm_peaks</span><span class="o">.</span><span class="n">all_harmonics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of peaks : 5
[ 2.  3.  5.  6.  7.  8.  9. 10. 12. 14. 18. 19. 20. 21. 23. 30. 31. 37.
 41. 42. 45. 52. 60. 62. 66. 67. 71. 73.]
Number of peaks : 3
[ 2.  5.  6.  7.  8.  9. 10. 12. 18. 19. 20. 21. 30. 31. 42. 45. 52. 60.
 62. 66. 67. 71. 73.]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.scale_construction</span> <span class="kn">import</span> <span class="n">harmonic_tuning</span>
<span class="c1"># deriving harmonic tuning from recurrent harmonics</span>
<span class="n">harm_tuning</span> <span class="o">=</span> <span class="n">harmonic_tuning</span><span class="p">(</span><span class="n">biotuning_harm_peaks</span><span class="o">.</span><span class="n">all_harmonics</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">harm_tuning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.03125, 1.046875, 1.109375, 1.125, 1.140625, 1.1875, 1.25, 1.3125, 1.40625, 1.5, 1.625, 1.75, 1.875, 1.9375, 2.0]
</pre></div>
</div>
</div>
</div>
<p>Instead of using all the harmonics, we can use the harmonic positions of a single peak to generate a tuning</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># find harmonic positions of first peak</span>
<span class="n">harmonics</span> <span class="o">=</span> <span class="n">biotuning_harm_peaks</span><span class="o">.</span><span class="n">harm_peaks_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># compute harmonic tuning</span>
<span class="n">harm_peak_tuning</span> <span class="o">=</span> <span class="n">harmonic_tuning</span><span class="p">(</span><span class="n">harmonics</span><span class="p">)</span>

<span class="c1"># print results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Harmonics&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">harmonics</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tuning&#39;</span><span class="p">,</span> <span class="n">harm_peak_tuning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Harmonics [5, 7, 8, 19, 42, 45, 52, 62, 66, 67, 71, 73]
Tuning [1.03125, 1.046875, 1.109375, 1.140625, 1.1875, 1.25, 1.3125, 1.40625, 1.625, 1.75, 1.9375, 2.0]
</pre></div>
</div>
</div>
</div>
<p>We will now compute the harmonicity metrics associated with the tuning</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.metrics</span> <span class="kn">import</span> <span class="n">tuning_to_metrics</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">tuning_to_metrics</span><span class="p">(</span><span class="n">harm_peak_tuning</span><span class="p">)</span>
<span class="n">metrics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\User\anaconda3\envs\biotuner\lib\site-packages\numpy\lib\function_base.py:380: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis)
c:\Users\User\anaconda3\envs\biotuner\lib\site-packages\numpy\core\_methods.py:189: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;sum_p_q&#39;: 708,
 &#39;sum_distinct_intervals&#39;: 132,
 &#39;metric_3&#39;: 89.5821733821734,
 &#39;sum_p_q_for_all_intervals&#39;: 12718,
 &#39;sum_q_for_all_intervals&#39;: 5238,
 &#39;harm_sim&#39;: 20.53,
 &#39;matrix_harm_sim&#39;: 7.408307919171108,
 &#39;matrix_cons&#39;: 0.07770664568642607,
 &#39;matrix_denom&#39;: 44.07575757575758}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-inter-harmonic-concordance">
<h4>5.2.2. Using inter-harmonic concordance<a class="headerlink" href="#using-inter-harmonic-concordance" title="Permalink to this headline">#</a></h4>
<p>This method constructs the harmonic tuning based on the positions of common harmonics of spectral peaks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize biotuner object</span>
<span class="n">bt_harm_fit_peaks</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;harmonic_recurrence&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> 

<span class="c1"># Extract spectral peaks with minimum of 2 recurrent harmonics</span>
<span class="n">bt_harm_fit_peaks</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">min_harms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">harm_limit</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">biotuning_harm_peaks</span><span class="o">.</span><span class="n">all_harmonics</span><span class="p">)</span>

<span class="c1"># Compute the harmonic tuning</span>
<span class="n">harm_tuning2</span> <span class="o">=</span> <span class="n">bt_harm_fit_peaks</span><span class="o">.</span><span class="n">harmonic_fit_tuning</span><span class="p">(</span><span class="n">n_harm</span> <span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">n_common_harms</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">harm_tuning2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of peaks : 5
[ 2.  5.  6.  7.  8.  9. 10. 12. 18. 19. 20. 21. 30. 31. 42. 45. 52. 60.
 62. 66. 67. 71. 73.]
[1.015625, 1.078125, 1.15625, 1.21875, 1.25, 1.4375, 1.5, 1.625, 1.734375, 1.75, 1.796875, 2.0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute harmonicity metrics associated with the tuning</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">tuning_to_metrics</span><span class="p">(</span><span class="n">harm_tuning2</span><span class="p">)</span>
<span class="n">metrics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;sum_p_q&#39;: 844,
 &#39;sum_distinct_intervals&#39;: 100,
 &#39;metric_3&#39;: 102.607080278920,
 &#39;sum_p_q_for_all_intervals&#39;: 11938,
 &#39;sum_q_for_all_intervals&#39;: 4922,
 &#39;harm_sim&#39;: 24.52,
 &#39;matrix_harm_sim&#39;: 12.174391250478207,
 &#39;matrix_cons&#39;: 0.13362222995375167,
 &#39;matrix_denom&#39;: 42.43939393939394}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="scale-from-generator-interval">
<h2>5.3. Scale from generator interval<a class="headerlink" href="#scale-from-generator-interval" title="Permalink to this headline">#</a></h2>
<p>To derive a scale from a generator interval, the first step is to find which interval will be used based on the harmonic structure of the time series. In this example, we will find the most consonant peaks ratio and use it as a generator interval for tuning construction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.metrics</span> <span class="kn">import</span> <span class="n">consonant_ratios</span>
<span class="c1"># Define data (single time series)</span>
<span class="n">data_gen</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span> 

<span class="c1"># Initialize biotuner object</span>
<span class="n">bt_gen_int</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;EMD&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">n_harm</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                    <span class="n">ratios_n_harms</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">ratios_inc_fit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ratios_inc</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Initialize biotuner object</span>

<span class="c1"># Extract spectral peaks</span>
<span class="n">bt_gen_int</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_gen</span><span class="p">,</span> <span class="n">FREQ_BANDS</span> <span class="o">=</span> <span class="n">FREQ_BANDS</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Find most consonant peaks ratio</span>
<span class="n">ratios</span><span class="p">,</span> <span class="n">cons</span> <span class="o">=</span> <span class="n">consonant_ratios</span><span class="p">(</span><span class="n">bt_gen_int</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">input_type</span> <span class="o">=</span> <span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;harmsim&#39;</span><span class="p">)</span> <span class="c1">#finding the intervals</span>
<span class="n">ratio_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cons</span><span class="p">)</span>
<span class="n">cons_ratio</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">ratio_arg</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index_max: all zeros indicate 1/f trend [0, 33, 46, 20, 93, 20]
Number of peaks : 5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\User\anaconda3\envs\biotuner\lib\site-packages\scipy\signal\_spectral_py.py:1999: UserWarning: nperseg = 10000 is greater than input length  = 9501, using nperseg = 9501
  warnings.warn(&#39;nperseg = {0:d} is greater than input length &#39;
</pre></div>
</div>
</div>
</div>
<p>The most simple way to derive a scale from a generator interval is to generate an equal temperament tuning, meaning that each step equally spaced on a logarithmic scale. To do so, we take our consonant ratio, and find in how many steps we need to divide the octave to retrieve this ratio within the steps. Then, we generate the NTET with this number of steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.biotuner_utils</span> <span class="kn">import</span> <span class="n">NTET_ratios</span><span class="p">,</span> <span class="n">ratio2frac</span>
<span class="kn">from</span> <span class="nn">biotuner.scale_construction</span> <span class="kn">import</span> <span class="n">oct_subdiv</span>

<span class="c1"># Find potential number of steps to divide the octave</span>
<span class="n">octdiv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">oct_subdiv</span><span class="p">(</span><span class="n">cons_ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Consonant ratio :&#39;</span><span class="p">,</span> <span class="n">ratio2frac</span><span class="p">(</span><span class="n">cons_ratio</span><span class="p">,</span> <span class="n">maxdenom</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Possible octave subdivisions :&#39;</span><span class="p">,</span> <span class="n">octdiv</span><span class="p">)</span>

<span class="c1"># Construct the NTET</span>
<span class="n">NTET</span> <span class="o">=</span> <span class="n">NTET_ratios</span><span class="p">(</span><span class="n">octdiv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_ratio</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Consonant ratio : [102, 83] 
Possible octave subdivisions : [37, 74, 121, 158, 195]
</pre></div>
</div>
</div>
</div>
<p>The biotuner also provides a function that looks at multiple consonant peaks ratios and find the number of subdivisions that optimize having multiple consonant ratios within the same NTET scale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.scale_construction</span> <span class="kn">import</span> <span class="n">multi_oct_subdiv</span>

<span class="c1"># Find optimal NTET from a series of spectral peaks</span>
<span class="n">oct_divs</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">multi_oct_subdiv</span><span class="p">(</span>
                <span class="n">bt_gen_int</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">max_sub</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                <span class="n">octave_limit</span><span class="o">=</span><span class="mf">0.01365</span><span class="p">,</span>
                <span class="n">octave</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">n_scales</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">cons_limit</span><span class="o">=</span><span class="mf">0.01</span>
            <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal NTET divides the octave in </span><span class="si">{}</span><span class="s1"> steps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oct_divs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimal NTET divides the octave in 55 steps
</pre></div>
</div>
</div>
</div>
<p>Another way to create a tuning from a generator interval is by using the “create_equal_interval_scale” from PyTuning toolbox. In the creation of such scale, the generator interval can either be used directly (making each successive tone a generator interval above the previous tone), or in an inverted sense (making each interval a generator down from the previous). This function starts from the unison and walks down the number specified, walking up for the rest of the intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the tuning</span>
<span class="n">gen_interval_tuning</span> <span class="o">=</span> <span class="n">pytuning</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">create_equal_interval_scale</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scale_size</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="n">number_down_intervals</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">octave</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">gen_interval_tuning</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gen_interval_tuning</span><span class="p">]</span>

<span class="c1"># Transform the ratios into fractions with controlled maximum denominator.</span>
<span class="n">frac</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scale2frac</span><span class="p">(</span><span class="n">gen_interval_tuning</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="c1"># Using smaller denominator limit will maximize the chance to find intervalic names in the dictionary</span>
<span class="n">frac2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scale2frac</span><span class="p">(</span><span class="n">gen_interval_tuning</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">scale_interval_names</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">reduce</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">scale_interval_names</span><span class="p">(</span><span class="n">frac2</span><span class="p">,</span> <span class="n">reduce</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1, &#39;Unison&#39;], [61/58, None], [69/62, None], [48/41, None], [57/46, None], [73/56, None], [51/37, None], [74/51, None], [89/58, None], [92/57, None], [115/64, &#39;Hundred-fifteenth Harmonic&#39;], [2, &#39;Octave&#39;]] 

 [[1, &#39;Unison&#39;], [17/16, &#39;Minor Diatonic Semitone&#39;], [10/9, &#39;Small Just Whole Tone&#39;], [7/6, &#39;Septimal Minor Third&#39;], [16/13, &#39;Tridecimal Neutral Third&#39;], [13/10, &#39;Tridecimal Major Third &#39;], [11/8, &#39;Eleventh Harmonic&#39;], [16/11, &#39;Undecimal Semi-diminished Fifth&#39;], [23/15, None], [21/13, None], [9/5, &#39;Greater Just Minor Seventh&#39;], [2, &#39;Octave&#39;]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="scale-reduction">
<h2>6. Scale reduction<a class="headerlink" href="#scale-reduction" title="Permalink to this headline">#</a></h2>
<p>When a scale has high number of steps, it might be useful to reduce it to a specific number of steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.scale_construction</span> <span class="kn">import</span> <span class="n">tuning_reduction</span>

<span class="c1"># scale reduction based on harmonicity between ratios</span>
<span class="n">tuning_metric</span><span class="p">,</span> <span class="n">reducted_tuning</span><span class="p">,</span> <span class="n">mode_metric</span> <span class="o">=</span> <span class="n">tuning_reduction</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_ratios</span><span class="p">,</span> <span class="n">mode_n_steps</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> 
                                                            <span class="n">function</span> <span class="o">=</span> <span class="n">dyad_similarity</span><span class="p">,</span> <span class="n">ratio_type</span><span class="o">=</span><span class="s1">&#39;pos_harm&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tuning :&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_ratios</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Tuning harmonicity :&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tuning_metric</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Mode :&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reducted_tuning</span><span class="p">),</span>
      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Mode harmonicity :&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">mode_metric</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tuning : [1.14 1.23 1.44 1.62 1.64 1.75 1.77 1.86 2.  ] 
Tuning harmonicity : 9.29 
Mode : [1.1429 1.75   1.8571 2.    ] 
Mode harmonicity : 13.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="scale-from-multiple-time-series">
<h2>7. Scale from multiple time series<a class="headerlink" href="#scale-from-multiple-time-series" title="Permalink to this headline">#</a></h2>
<div class="section" id="multiple-dissonance-curves">
<h3>Multiple dissonance curves<a class="headerlink" href="#multiple-dissonance-curves" title="Permalink to this headline">#</a></h3>
<p>Multiple time series can be used to compute multiple dissonance curves. The function <em>diss_curve_multi</em> takes a list of list of frequency peaks and amplitudes and gives as output the dissonant minima that are shared by minimally 2 dissonance curves. Here we iterate across <em>n</em> trials to generate multiple dissonance curves. The same process can be done across electrodes to find tunings that are consistent with the harmonic architecture of multiple electrodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.biotuner2d</span> <span class="kn">import</span> <span class="n">diss_curve_multi</span>
<span class="n">n_harm</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">peaks_tot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">amps_tot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">+=</span><span class="mi">0</span>
    <span class="n">data_</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
    <span class="n">diss_tun</span> <span class="o">=</span> <span class="n">compute_biotuner</span><span class="p">(</span><span class="n">sf</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peaks_function</span> <span class="o">=</span> <span class="s1">&#39;EMD&#39;</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">ratios_n_harms</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">ratios_inc_fit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ratios_inc</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Initialize biotuner object</span>
    <span class="n">diss_tun</span><span class="o">.</span><span class="n">peaks_extraction</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">ratios_extension</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">diss_tun</span><span class="o">.</span><span class="n">peaks_extension</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;harmonic_fit&#39;</span><span class="p">,</span> <span class="n">n_harm</span> <span class="o">=</span> <span class="n">n_harm</span><span class="p">)</span>
    <span class="n">peaks_tot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diss_tun</span><span class="o">.</span><span class="n">extended_peaks</span><span class="p">)</span>
    <span class="n">amps_tot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diss_tun</span><span class="o">.</span><span class="n">extended_amps</span><span class="p">)</span>

<span class="n">diss_tot</span> <span class="o">=</span> <span class="n">diss_curve_multi</span><span class="p">(</span><span class="n">peaks_tot</span><span class="p">,</span> <span class="n">amps_tot</span><span class="p">,</span> <span class="n">denom</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_ratio</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">],</span> <span class="n">n_tet_grid</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;Trials&#39;</span><span class="p">)</span>
<span class="c1">#biotuning.psd.shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index_max: all zeros indicate 1/f trend [2, 2, 11, 9, 10]
Number of peaks : 5
Number of extended peaks :  7
Index_max: all zeros indicate 1/f trend [2, 2, 11, 6, 10]
Number of peaks : 5
Number of extended peaks :  6
Index_max: all zeros indicate 1/f trend [1, 2, 0, 6, 10]
Number of peaks : 5
Number of extended peaks :  14
Index_max: all zeros indicate 1/f trend [2, 6, 1, 5, 10]
Number of peaks : 5
Number of extended peaks :  17
Index_max: all zeros indicate 1/f trend [2, 1, 11, 6, 12]
Number of peaks : 5
Number of extended peaks :  15
6/5
6/5
5/4
5/4
115/88
4/3
4/3
3/2
8/5
5/3
5/3
7/4
174/95
</pre></div>
</div>
<img alt="../../_images/scale_construction_54_1.png" src="../../_images/scale_construction_54_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="exporting-scale-in-scala-format">
<h2>8. Exporting scale in scala format<a class="headerlink" href="#exporting-scale-in-scala-format" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.biotuner_utils</span> <span class="kn">import</span> <span class="n">create_SCL</span>
<span class="n">create_SCL</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">HE_scale</span><span class="p">,</span> <span class="s1">&#39;Harmonic_entropy_scale&#39;</span><span class="p">)</span>
<span class="n">create_SCL</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_ratios</span><span class="p">,</span> <span class="s1">&#39;Peaks_ratios_scale&#39;</span><span class="p">)</span>
<span class="n">create_SCL</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">extended_peaks_ratios_cons</span><span class="p">,</span> <span class="s1">&#39;consonant_extended_peaks_ratios_scale&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plotting-consonance-matrix-for-a-specific-scale">
<h2>9. Plotting consonance matrix for a specific scale<a class="headerlink" href="#plotting-consonance-matrix-for-a-specific-scale" title="Permalink to this headline">#</a></h2>
<p>The metric_function can be set to:</p>
<ul class="simple">
<li><p>None : the denominator of the normalized ratio</p></li>
<li><p>dyad_similarity : similarity with the harmonic series</p></li>
<li><p>consonance : (a+b)/(a*b)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytuning.visualizations.scales</span> <span class="kn">import</span> <span class="n">consonance_matrix</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">euler_fokker_scale</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;extended_peaks&#39;</span><span class="p">,</span> <span class="n">octave</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">cons_matrix</span> <span class="o">=</span> <span class="n">consonance_matrix</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;magma_r&#39;</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">cons_matrix_harmsim</span> <span class="o">=</span> <span class="n">consonance_matrix</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">metric_function</span> <span class="o">=</span> <span class="n">dyad_similarity</span><span class="p">,</span>
                                        <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/scale_construction_58_0.png" src="../../_images/scale_construction_58_0.png" />
<img alt="../../_images/scale_construction_58_1.png" src="../../_images/scale_construction_58_1.png" />
</div>
</div>
</div>
<div class="section" id="computing-scale-metrics">
<h2>10. Computing scale metrics<a class="headerlink" href="#computing-scale-metrics" title="Permalink to this headline">#</a></h2>
<p>The harmonicity of a scale can be assessed by different metrics.</p>
<div class="section" id="from-peaks-ratios">
<h3>From peaks ratios<a class="headerlink" href="#from-peaks-ratios" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.metrics</span> <span class="kn">import</span> <span class="n">tuning_to_metrics</span>
<span class="n">metrics_peaks</span> <span class="o">=</span> <span class="n">tuning_to_metrics</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_ratios</span><span class="p">)</span>
<span class="n">metrics_peaks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\User\anaconda3\envs\biotuner\lib\site-packages\numpy\lib\function_base.py:380: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis)
c:\Users\User\anaconda3\envs\biotuner\lib\site-packages\numpy\core\_methods.py:189: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;sum_p_q&#39;: 211,
 &#39;sum_distinct_intervals&#39;: 38,
 &#39;metric_3&#39;: 21.5746031746032,
 &#39;sum_p_q_for_all_intervals&#39;: 8497,
 &#39;sum_q_for_all_intervals&#39;: 3508,
 &#39;harm_sim&#39;: 27.5,
 &#39;matrix_harm_sim&#39;: 9.289929639476492,
 &#39;matrix_cons&#39;: 0.0972719610995822,
 &#39;matrix_denom&#39;: 60.25}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="from-harmonic-entropy-tuning">
<h3>From harmonic entropy tuning<a class="headerlink" href="#from-harmonic-entropy-tuning" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics_peaks</span> <span class="o">=</span> <span class="n">tuning_to_metrics</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">HE_scale</span><span class="p">)</span>
<span class="n">metrics_peaks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;sum_p_q&#39;: 29847,
 &#39;sum_distinct_intervals&#39;: 420,
 &#39;metric_3&#39;: 151.999002802882,
 &#39;sum_p_q_for_all_intervals&#39;: 901446,
 &#39;sum_q_for_all_intervals&#39;: 416490,
 &#39;harm_sim&#39;: 0.58,
 &#39;matrix_harm_sim&#39;: 0.396151170895823,
 &#39;matrix_cons&#39;: 0.0039701875712443635,
 &#39;matrix_denom&#39;: 945.5333333333333}
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="visualizing-ratios-with-lissajous-curves">
<h2>11. Visualizing ratios with Lissajous curves<a class="headerlink" href="#visualizing-ratios-with-lissajous-curves" title="Permalink to this headline">#</a></h2>
<p>A Lissajous curve is the graph of a system of parametric equations which describe the superposition of two perpendicular oscillations in x and y directions of different angular frequency (a and b). Hence, it allows to visualize ratio (a/b).</p>
<p>Thanks to https://glowingpython.blogspot.com/2011/12/lissajous-curves.html</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">biotuner.vizs</span> <span class="kn">import</span> <span class="n">lissajous_curves</span>
<span class="n">tuning</span> <span class="o">=</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">harmonic_fit_tuning</span>
<span class="n">tuning</span> <span class="o">=</span> <span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_ratios</span>
<span class="n">lissajous_curves</span><span class="p">(</span><span class="n">tuning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8/7, 16/13, 23/16, 13/8, 23/14, 7/4, 23/13, 13/7, 2]
</pre></div>
</div>
<img alt="../../_images/scale_construction_65_1.png" src="../../_images/scale_construction_65_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lissajous_curves</span><span class="p">(</span><span class="n">gen_interval_tuning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 525/499, 1113/1000, 767/655, 965/779, 1259/966, 1103/800, 1233/850, 1177/767, 1558/965, 1177/655, 2]
</pre></div>
</div>
<img alt="../../_images/scale_construction_66_1.png" src="../../_images/scale_construction_66_1.png" />
</div>
</div>
</div>
<div class="section" id="listening-to-scales">
<h2>12. Listening to scales<a class="headerlink" href="#listening-to-scales" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">biotuner</span>
<span class="kn">from</span> <span class="nn">biotuner.biotuner_utils</span> <span class="kn">import</span> <span class="n">listen_scale</span>
<span class="n">listen_scale</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">peaks_ratios</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale: [1.1428571428571428, 1.2307692307692308, 1.4375, 1.625, 1.6428571428571428, 1.75, 1.7692307692307692, 1.8571428571428572, 2.0]
250
285.7142857142857
307.69230769230774
359.375
406.25
410.7142857142857
437.5
442.30769230769226
464.2857142857143
500.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listen_scale</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">biotuning</span><span class="o">.</span><span class="n">HE_scale</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">100</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale: [1.018 1.036 1.07  1.101 1.122 1.196 1.266 1.283 1.315 1.349 1.379 1.451
 1.494 1.57  1.603 1.646 1.71  1.792 1.818 1.927 1.967]
201.79999999999998
203.6
207.00000000000003
210.1
212.2
219.59999999999997
226.6
228.29999999999998
231.5
234.90000000000003
237.9
245.1
249.39999999999998
257.0
260.29999999999995
264.59999999999997
271.0
279.2
281.8
292.7
296.7
</pre></div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../harmonic_spectrum/harmonic_spectrum.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">From Spectral Peaks to Harmonic Spectrum Analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../spectral_chords/spectral_chords.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deriving spectral chords from biosignals</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Antoine Bellemare & François Lespinasse. This documentation is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> license.<br/>
  
      &copy; Copyright 2023–2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>